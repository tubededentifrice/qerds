<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ _('common.app_title') }}{% endblock %} - {{ _('common.app_description') }}</title>
    <link rel="preconnect" href="/static/fonts/">
    <link rel="stylesheet" href="/static/css/fonts.css">
    <link rel="stylesheet" href="/static/css/main.css">
    {% block head %}{% endblock %}
</head>
<body class="qerds-body {% block body_class %}{% endblock %}">
    {% if qualification_mode == 'dev' %}
    {% include 'partials/dev_banner.html' %}
    {% endif %}

    {% block header %}
    <header class="qerds-header">
        <div class="header-container">
            <a href="/" class="header-brand">
                <div class="brand-logo">
                    <svg class="logo-icon" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="4" y="8" width="40" height="32" rx="2" stroke="currentColor" stroke-width="2.5"/>
                        <path d="M4 14L24 28L44 14" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
                        <circle cx="38" cy="14" r="6" fill="#E1000F"/>
                        <path d="M38 11V17M38 17L35 14M38 17L41 14" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <div class="brand-text">
                    <span class="brand-name">{{ _('common.app_title') }}</span>
                    <span class="brand-tagline">{{ _('common.app_tagline') }}</span>
                </div>
            </a>

            {% block nav %}
            <nav class="header-nav" aria-label="{{ _('nav.main_nav_label') }}">
                {% if user %}
                <ul class="nav-list">
                    {% if user.role == 'sender' %}
                    <li><a href="/sender/dashboard" class="nav-link {% if active_page == 'dashboard' %}active{% endif %}">{{ _('nav.dashboard') }}</a></li>
                    <li><a href="/sender/new" class="nav-link {% if active_page == 'new' %}active{% endif %}">{{ _('nav.new_delivery') }}</a></li>
                    <li><a href="/sender/history" class="nav-link {% if active_page == 'history' %}active{% endif %}">{{ _('nav.history') }}</a></li>
                    {% elif user.role == 'admin' %}
                    <li><a href="/admin/dashboard" class="nav-link {% if active_page == 'dashboard' %}active{% endif %}">{{ _('nav.dashboard') }}</a></li>
                    <li><a href="/admin/audit" class="nav-link {% if active_page == 'audit' %}active{% endif %}">{{ _('nav.audit') }}</a></li>
                    <li><a href="/admin/config" class="nav-link {% if active_page == 'config' %}active{% endif %}">{{ _('nav.config') }}</a></li>
                    {% endif %}
                </ul>
                {% endif %}
            </nav>
            {% endblock %}

            <div class="header-actions">
                {% include 'partials/language_switcher.html' %}
                {% if user %}
                <div class="user-menu">
                    <button class="user-menu-trigger" aria-expanded="false" aria-haspopup="true">
                        <span class="user-avatar">{{ user.initials }}</span>
                        <span class="user-name">{{ user.name }}</span>
                        <svg class="chevron-icon" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                        </svg>
                    </button>
                    <div class="user-dropdown" hidden>
                        <a href="/account" class="dropdown-item">{{ _('auth.my_account') }}</a>
                        <a href="/logout" class="dropdown-item dropdown-item--danger">{{ _('auth.logout') }}</a>
                    </div>
                </div>
                {% else %}
                <a href="/login" class="btn btn--primary btn--sm">{{ _('auth.login') }}</a>
                {% endif %}
            </div>
        </div>
    </header>
    {% endblock %}

    <main class="qerds-main" id="main-content">
        {% block main %}{% endblock %}
    </main>

    {% block footer %}
    <footer class="qerds-footer">
        <div class="footer-container">
            <div class="footer-top">
                <div class="footer-brand">
                    <span class="footer-logo">{{ _('common.app_title') }}</span>
                    <p class="footer-description">{{ _('footer.description') }}</p>
                </div>
                <div class="footer-links">
                    <div class="footer-column">
                        <h4 class="footer-heading">{{ _('footer.service') }}</h4>
                        <ul>
                            <li><a href="/about">{{ _('footer.about') }}</a></li>
                            <li><a href="/help">{{ _('footer.help') }}</a></li>
                            <li><a href="/contact">{{ _('footer.contact') }}</a></li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h4 class="footer-heading">{{ _('footer.legal') }}</h4>
                        <ul>
                            <li><a href="/legal/terms">{{ _('footer.terms') }}</a></li>
                            <li><a href="/legal/privacy">{{ _('footer.privacy') }}</a></li>
                            <li><a href="/legal/cookies">{{ _('footer.cookies') }}</a></li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h4 class="footer-heading">{{ _('footer.compliance') }}</h4>
                        <ul>
                            <li><a href="/compliance/eidas">{{ _('footer.eidas_certification') }}</a></li>
                            <li><a href="/compliance/arcep">{{ _('footer.arcep_registration') }}</a></li>
                            <li><a href="/verify">{{ _('footer.proof_verification') }}</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p class="footer-legal">&copy; {{ current_year }} {{ _('common.app_title') }} - {{ _('footer.all_rights_reserved') }}</p>
                <p class="footer-compliance">
                    {% if qualification_mode == 'qualified' %}
                    <span class="compliance-badge compliance-badge--qualified">
                        <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/></svg>
                        {{ _('qualification.qualified') }}
                    </span>
                    {% else %}
                    <span class="compliance-badge compliance-badge--dev">
                        {{ _('qualification.dev_not_qualified') }}
                    </span>
                    {% endif %}
                </p>
            </div>
        </div>
    </footer>
    {% endblock %}

    <script src="/static/js/main.js"></script>
    {% block scripts %}{% endblock %}
</body>
</html>
